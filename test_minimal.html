<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Minimal - Sistema CMG</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CAJEROS = ['Mariana', 'Edgar', 'Cris'];
        const CONTRASE√ëA_SISTEMA = 'cmg2025';
        const FONDO_INICIAL_DEFAULT = 1000;

        const logoSVG = `<svg width="60" height="60" viewBox="0 0 100 100"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:rgb(219,39,119);stop-opacity:1" /><stop offset="50%" style="stop-color:rgb(168,85,247);stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(99,102,241);stop-opacity:1" /></linearGradient></defs><path d="M 50 10 L 90 30 L 90 70 L 50 90 L 10 70 L 10 30 Z" fill="url(#grad)" opacity="0.9"/><rect x="30" y="30" width="40" height="40" fill="white" opacity="0.3"/><rect x="20" y="45" width="20" height="30" fill="white" opacity="0.4"/><rect x="60" y="45" width="20" height="30" fill="white" opacity="0.4"/></svg>`;

        function App() {
            const [turnoActual, setTurnoActual] = useState(null);
            const [formApertura, setFormApertura] = useState({
                cajero: '',
                contrase√±a: '',
                fondoInicial: FONDO_INICIAL_DEFAULT
            });
            const [notification, setNotification] = useState({ show: false, message: '', type: '' });

            // Cargar turno actual desde localStorage
            useEffect(() => {
                console.log('üîç Cargando aplicaci√≥n...');
                const turnoGuardado = localStorage.getItem('turnoActual');
                if (turnoGuardado) {
                    try {
                        const turno = JSON.parse(turnoGuardado);
                        const fechaHoy = new Date().toLocaleDateString('es-MX');

                        console.log('üìÖ Fecha turno:', turno.fecha);
                        console.log('üìÖ Fecha hoy:', fechaHoy);

                        if (turno.fecha === fechaHoy) {
                            setTurnoActual(turno);
                            console.log('‚úÖ Turno cargado:', turno.turno_id);
                        } else {
                            localStorage.removeItem('turnoActual');
                            console.log('‚ö†Ô∏è Turno expirado eliminado');
                        }
                    } catch (error) {
                        console.error('‚ùå Error al cargar turno:', error);
                        localStorage.removeItem('turnoActual');
                    }
                }
                console.log('‚úÖ Aplicaci√≥n cargada');
            }, []);

            const showNotification = (message, type = 'success') => {
                setNotification({ show: true, message, type });
                setTimeout(() => {
                    setNotification({ show: false, message: '', type: '' });
                }, 3000);
            };

            const abrirTurno = () => {
                try {
                    console.log('üîë Intentando abrir turno...');

                    if (!formApertura.cajero) {
                        showNotification('Selecciona un cajero', 'error');
                        return;
                    }

                    if (formApertura.contrase√±a !== CONTRASE√ëA_SISTEMA) {
                        showNotification('‚ùå Contrase√±a incorrecta', 'error');
                        console.warn('Contrase√±a incorrecta');
                        return;
                    }

                    const fechaActual = new Date();
                    const fechaStr = fechaActual.toISOString().split('T')[0].replace(/-/g, '');
                    const horaStr = fechaActual.toTimeString().split(':').slice(0, 2).join('');
                    const turno_id = `TURN-${fechaStr}-${horaStr}-${formApertura.cajero}`;

                    const nuevoTurno = {
                        turno_id,
                        fecha: fechaActual.toLocaleDateString('es-MX'),
                        hora_apertura: fechaActual.toLocaleTimeString('es-MX'),
                        cajero: formApertura.cajero,
                        fondo_inicial: parseFloat(formApertura.fondoInicial),
                        estado: 'abierto'
                    };

                    setTurnoActual(nuevoTurno);
                    localStorage.setItem('turnoActual', JSON.stringify(nuevoTurno));
                    showNotification(`‚úÖ Turno abierto - ${formApertura.cajero}`, 'success');

                    console.log('‚úÖ Turno abierto:', turno_id);
                    console.log('Turno guardado en localStorage:', localStorage.getItem('turnoActual'));

                } catch (error) {
                    console.error('‚ùå Error al abrir turno:', error);
                    showNotification('Error al abrir turno', 'error');
                }
            };

            console.log('üé® Renderizando componente. TurnoActual:', turnoActual);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    {/* Notificaci√≥n */}
                    {notification.show && (
                        <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                            notification.type === 'error'
                                ? 'bg-red-500 text-white'
                                : 'bg-green-500 text-white'
                        }`}>
                            {notification.message}
                        </div>
                    )}

                    {!turnoActual ? (
                        <div className="min-h-screen flex items-center justify-center p-4">
                            <div className="text-center">
                                <div className="mb-8">
                                    <div className="flex justify-center mb-6" dangerouslySetInnerHTML={{ __html: logoSVG.replace('width="60" height="60"', 'width="120" height="120"') }} />
                                    <h1 className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-600 via-purple-600 to-indigo-600 mb-3">
                                        Sistema CMG - TEST
                                    </h1>
                                    <p className="text-2xl text-gray-700 font-semibold mb-6">
                                        Versi√≥n de Prueba M√≠nima
                                    </p>
                                </div>

                                <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 mx-auto">
                                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">
                                        Apertura de Turno
                                    </h2>

                                    <div className="space-y-5">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Cajero
                                            </label>
                                            <select
                                                value={formApertura.cajero}
                                                onChange={(e) => setFormApertura(prev => ({...prev, cajero: e.target.value}))}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                            >
                                                <option value="">Seleccionar cajero...</option>
                                                {CAJEROS.map(cajero => (
                                                    <option key={cajero} value={cajero}>{cajero}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Contrase√±a del Sistema
                                            </label>
                                            <input
                                                type="password"
                                                value={formApertura.contrase√±a}
                                                onChange={(e) => setFormApertura(prev => ({...prev, contrase√±a: e.target.value}))}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                                placeholder="Ingresa la contrase√±a (cmg2025)"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Dinero Inicial de Caja
                                            </label>
                                            <input
                                                type="number"
                                                value={formApertura.fondoInicial}
                                                onChange={(e) => setFormApertura(prev => ({...prev, fondoInicial: e.target.value}))}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                                placeholder="1000.00"
                                                step="0.01"
                                            />
                                        </div>
                                    </div>

                                    <div className="mt-8">
                                        <button
                                            onClick={abrirTurno}
                                            className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg text-lg"
                                        >
                                            Abrir Turno
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="min-h-screen flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8">
                                <div className="text-center mb-6">
                                    <div className="flex justify-center mb-4" dangerouslySetInnerHTML={{ __html: logoSVG }} />
                                    <h1 className="text-4xl font-bold text-gray-800 mb-2">
                                        ¬°Turno Abierto!
                                    </h1>
                                    <div className="bg-green-100 text-green-800 px-6 py-3 rounded-lg inline-block">
                                        <p className="text-lg font-semibold">Cajero: {turnoActual.cajero}</p>
                                        <p className="text-sm">Turno ID: {turnoActual.turno_id}</p>
                                        <p className="text-sm">Hora: {turnoActual.hora_apertura}</p>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <button
                                        onClick={() => {
                                            localStorage.removeItem('turnoActual');
                                            setTurnoActual(null);
                                            showNotification('Turno cerrado', 'success');
                                        }}
                                        className="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl"
                                    >
                                        Cerrar Turno (Test)
                                    </button>

                                    <a
                                        href="sistema_cmg.html"
                                        className="block w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl text-center"
                                    >
                                        Ir al Sistema Principal
                                    </a>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        console.log('üöÄ Iniciando React...');
        ReactDOM.render(<App />, document.getElementById('root'));
        console.log('‚úÖ React iniciado correctamente');
    </script>
</body>
</html>
