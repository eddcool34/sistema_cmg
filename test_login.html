<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Login - Sistema CMG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-box p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }

        .info-box code {
            background: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #c62828;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result.success {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            color: #2e7d32;
            display: block;
        }

        .result.error {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
            display: block;
        }

        .result h3 {
            margin-bottom: 10px;
        }

        .debug-info {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 25px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .debug-info h3 {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin-bottom: 10px;
            color: #333;
        }

        .debug-line {
            margin: 5px 0;
            color: #555;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.ok {
            background: #4caf50;
            color: white;
        }

        .status-badge.error {
            background: #f44336;
            color: white;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Test de Login</h1>
        <p class="subtitle">Sistema CMG - Verificaci√≥n de Contrase√±a</p>

        <div class="info-box">
            <h3>üìã Informaci√≥n del Sistema</h3>
            <p>
                <strong>Contrase√±a del sistema:</strong> <code>cmg2025</code><br>
                <strong>Cajeros autorizados:</strong> Mariana, Edgar, Cris
            </p>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <label for="cajero">Selecciona un Cajero:</label>
                <select id="cajero" required>
                    <option value="">-- Seleccionar cajero --</option>
                    <option value="Mariana">Mariana</option>
                    <option value="Edgar">Edgar</option>
                    <option value="Cris">Cris</option>
                </select>
            </div>

            <div class="form-group">
                <label for="password">Contrase√±a del Sistema:</label>
                <input
                    type="password"
                    id="password"
                    placeholder="Ingresa la contrase√±a"
                    required
                >
            </div>

            <button type="submit">‚úì Validar Contrase√±a</button>
        </form>

        <div id="result" class="result"></div>

        <div class="debug-info">
            <h3>üîß Informaci√≥n de Debug</h3>
            <div class="debug-line">
                <strong>Contrase√±a esperada:</strong> <span id="expectedPass">cmg2025</span>
            </div>
            <div class="debug-line">
                <strong>Contrase√±a ingresada:</strong> <span id="inputPass">-</span>
            </div>
            <div class="debug-line">
                <strong>Longitud esperada:</strong> <span id="expectedLen">7</span>
            </div>
            <div class="debug-line">
                <strong>Longitud ingresada:</strong> <span id="inputLen">0</span>
            </div>
            <div class="debug-line">
                <strong>Match exacto:</strong> <span id="matchStatus">-</span>
            </div>
            <div class="debug-line">
                <strong>URL actual:</strong> <span id="currentUrl">-</span>
            </div>
            <div class="debug-line">
                <strong>Navegador:</strong> <span id="browser">-</span>
            </div>
        </div>
    </div>

    <script>
        // Contrase√±a del sistema (igual que en sistema_cmg.html l√≠nea 87)
        const CONTRASE√ëA_SISTEMA = 'cmg2025';
        const CAJEROS = ['Mariana', 'Edgar', 'Cris'];

        // Actualizar informaci√≥n de debug al cargar
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('browser').textContent = navigator.userAgent.split(' ').pop();
        });

        // Manejar el formulario
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const cajero = document.getElementById('cajero').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');

            // Actualizar debug info
            document.getElementById('inputPass').textContent = password;
            document.getElementById('inputLen').textContent = password.length;

            const match = password === CONTRASE√ëA_SISTEMA;
            document.getElementById('matchStatus').innerHTML = match
                ? '<span class="status-badge ok">‚úì COINCIDE</span>'
                : '<span class="status-badge error">‚úó NO COINCIDE</span>';

            // Validar cajero
            if (!cajero) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Error de Validaci√≥n</h3>
                    <p><strong>Debes seleccionar un cajero</strong></p>
                    <p>Por favor, selecciona uno de los cajeros autorizados de la lista.</p>
                `;
                return;
            }

            // Validar contrase√±a
            if (password !== CONTRASE√ëA_SISTEMA) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Contrase√±a Incorrecta</h3>
                    <p><strong>La contrase√±a ingresada no es correcta</strong></p>
                    <p><strong>Esperada:</strong> "${CONTRASE√ëA_SISTEMA}"</p>
                    <p><strong>Ingresada:</strong> "${password}"</p>
                    <p><strong>Diferencias detectadas:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${getDifferences(CONTRASE√ëA_SISTEMA, password)}
                    </ul>
                    <p style="margin-top: 15px; font-size: 14px;">
                        üí° <strong>Tip:</strong> La contrase√±a es case-sensitive (distingue may√∫sculas y min√∫sculas)
                    </p>
                `;
                console.warn(`‚ùå Intento de login fallido - Cajero: ${cajero}`);
                return;
            }

            // ¬°Login exitoso!
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>‚úÖ ¬°Login Exitoso!</h3>
                <p><strong>La contrase√±a es correcta</strong></p>
                <p><strong>Cajero:</strong> ${cajero}</p>
                <p><strong>Contrase√±a:</strong> ‚úì Validada correctamente</p>
                <p style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #4caf50;">
                    üéâ <strong>El c√≥digo del sistema funciona correctamente</strong><br>
                    Si no puedes entrar al sistema principal, el problema es de deployment o cach√©.
                </p>
                <p style="margin-top: 10px; font-size: 14px;">
                    üìÑ Revisa el archivo <strong>DIAGNOSTICO_LOGIN.md</strong> para soluciones
                </p>
            `;
            console.log(`‚úÖ Login exitoso - Cajero: ${cajero}`);
        });

        // Funci√≥n para detectar diferencias
        function getDifferences(expected, input) {
            if (expected.length !== input.length) {
                return `<li>Longitud diferente (esperada: ${expected.length}, ingresada: ${input.length})</li>`;
            }

            let differences = [];
            for (let i = 0; i < expected.length; i++) {
                if (expected[i] !== input[i]) {
                    differences.push(
                        `<li>Posici√≥n ${i + 1}: esperado "${expected[i]}" vs ingresado "${input[i]}"</li>`
                    );
                }
            }

            if (differences.length === 0) {
                return '<li>No se detectaron diferencias visibles (posible problema de encoding)</li>';
            }

            return differences.join('');
        }

        // Detectar cuando el usuario escribe la contrase√±a
        document.getElementById('password').addEventListener('input', function(e) {
            const value = e.target.value;
            document.getElementById('inputPass').textContent = value || '-';
            document.getElementById('inputLen').textContent = value.length;

            if (value.length > 0) {
                const match = value === CONTRASE√ëA_SISTEMA;
                document.getElementById('matchStatus').innerHTML = match
                    ? '<span class="status-badge ok">‚úì COINCIDE</span>'
                    : '<span class="status-badge error">‚úó NO COINCIDE</span>';
            } else {
                document.getElementById('matchStatus').textContent = '-';
            }
        });

        // Log inicial para debug
        console.log('%cüîê Sistema CMG - Test de Login', 'font-size: 16px; font-weight: bold; color: #667eea;');
        console.log('Contrase√±a esperada:', CONTRASE√ëA_SISTEMA);
        console.log('Cajeros autorizados:', CAJEROS);
        console.log('Archivo actual:', window.location.href);
    </script>
</body>
</html>
